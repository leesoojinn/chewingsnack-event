<!DOCTYPE html>
<html lang="ko">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta charset="UTF-8" />
  <title>ğŸ’—ì¸„ì‰ìŠ¤ë‚µ ì´ë²¤íŠ¸ ëŒë¦¼íŒğŸ’—</title>
  <style>
    body {
      font-family: 'Nanum Gothic', sans-serif;
      max-width: 480px;
      margin: 0 auto;
      padding: 15px;
      background: #fff6fa;
      color: #704c3a;
      text-align: center;
    }
    h2 { text-align: center; margin-bottom: 25px; color: #f5a6c6; }
    label, input, button { font-size: 1rem; }
    input[type=number]{
      padding: 6px 8px; width: 120px; border: 1px solid #ffd6e5;
      border-radius: 4px; margin-right: 10px; background: #fff;
    }
    button{
      padding: 7px 14px; background: #ffb6c1; border: none; border-radius: 6px;
      color: white; cursor: pointer; font-weight: bold; transition: background 0.3s ease;
    }
    button:hover:not(:disabled){ background:#ff9db5; }
    button:disabled{ background:#ffd2db; cursor:not-allowed; }

    #wheelContainer{
      margin: 20px auto; position: relative; width: 300px; height: 300px;
      border-radius: 50%; overflow: visible; user-select: none;
      display:flex; justify-content:center; align-items:center;
      /* ë°”ê¹¥ìª½ ì€ì€í•œ ê·¸ë¦¼ì */
      box-shadow: 0 0 18px rgba(131, 76, 199, .35);
      background: transparent;
    }
    #wheel{
      width: 100%; height: 100%;
      transition: transform 4s cubic-bezier(0.33, 1, 0.68, 1);
      transform-origin: 50% 50%;
    }
    /* í¬ì¸í„°ë¥¼ ë³´ë¼ìƒ‰ìœ¼ë¡œ ë³€ê²½ */
    #spinPointer{
      position:absolute; top:-12px; left:50%; transform:translateX(-50%);
      width:0; height:0; border-left:20px solid transparent; border-right:20px solid transparent;
      border-top:30px solid #6d33a8; /* ì§„ë³´ë¼ */
      z-index:10; filter: drop-shadow(0 2px 2px rgba(0,0,0,0.15));
      user-select:none; pointer-events:none;
    }

    #resultPanel{
      margin:20px auto; background:#fff0f5; padding:10px; border-radius:8px;
      width:90%; box-shadow: inset 0 0 6px #ffc0cb77; color:#8c5b6e;
    }
    #history{ margin-top:10px; max-height:120px; overflow-y:auto; font-size:.9rem; line-height:1.4; color:#b5677d; }
    #tierInfo{ margin-top:8px; color:#f5a6c6; font-weight:bold; }
  </style>
</head>
<body>

<h2>ğŸ’—ì¸„ì‰ìŠ¤ë‚µ ì´ë²¤íŠ¸ ëŒë¦¼íŒğŸ’—</h2>

<div>
  <label for="purchaseAmount">êµ¬ë§¤ê¸ˆì•¡(ì›): </label>
  <input type="number" id="purchaseAmount" placeholder="ì˜ˆ: 45000" min="0" />
  <button id="applyAmount">ì ìš©</button>
  <div id="tierInfo"></div>
</div>

<div id="wheelContainer">
  <div id="wheel"></div>
  <div id="spinPointer"></div>
</div>

<button id="spinBtn" disabled>íšŒì „íŒ ëŒë¦¬ê¸°</button>

<div id="resultPanel">
  <div><strong>ë§ˆì§€ë§‰ ë‹¹ì²¨ ê²°ê³¼: </strong><span id="lastResult">-</span></div>
  <div><strong>ë‚¨ì€ íšŸìˆ˜: </strong><span id="spinsLeft">0</span></div>
  <div id="history"><strong>íˆìŠ¤í† ë¦¬:</strong><br/></div>
</div>

<script>
  const prizes = [
    "+0g ì˜¤íŠ¸ë°€ê°•ì •", "+0g ê³ êµ¬ë§ˆ ì ¤ë¦¬", "+0g ë°”ì‚­íŒŒì¹©",
    "+0g ì˜¤íŠ¸ë¦¬ì–¼ì¹©", "+0g ë™ê·¸ë¦¬ ì ¤ë¦¬", "+0g ê³ êµ¬ë§ˆì¹©",
    "+0g ê³ êµ¬ë§ˆë§ë­ì´", "+0g ë¿”ë§ˆì¹©", "+0g íë¹… ì ¤ë¦¬",
    "+0g ì°¸ë§ˆê¹¨ìŠ¤í‹±", "+0g í˜¸ë‘í’ˆì€ëŒ€ì¶”", "+0g ëª¨ì–‘ ì ¤ë¦¬",
    "+0g ê³ êµ¬ë§ˆìŠ¤í‹±", "+0g ë¿”ë§ˆì¹©", "+0g ì‚¬ê° ì ¤ë¦¬"
  ];

  const wheel = document.getElementById('wheel');
  const spinBtn = document.getElementById('spinBtn');
  const lastResultSpan = document.getElementById('lastResult');
  const spinsLeftSpan = document.getElementById('spinsLeft');
  const historyDiv = document.getElementById('history');
  const tierInfoDiv = document.getElementById('tierInfo');
  const purchaseAmountInput = document.getElementById('purchaseAmount');
  const applyAmountBtn = document.getElementById('applyAmount');

  let spinsLeft = 0;
  let currentRotation = 0;

  function drawWheel() {
    const numSegments = prizes.length;
    const size = 300;
    const cx = size / 2;
    const cy = size / 2;
    const canvas = document.createElement('canvas');
    canvas.width = size;
    canvas.height = size;
    const ctx = canvas.getContext('2d');

    // ===== ë””ìì¸ ìƒ‰ =====
    const deepPurple = '#5b2d91';   // ë°”ê¹¥ í…Œë‘ë¦¬(ì§„ë³´ë¼)
    const dotWhite   = '#ffffff';   // ì™¸ê³½ í° ì 
    const wedgeA     = '#e9e0fb';   // ì—°ë³´ë¼ ì›¨ì§€ A
    const wedgeB     = '#efe7ff';   // ì—°ë³´ë¼ ì›¨ì§€ B
    const ringLight  = '#a879ff';   // ì•ˆìª½ ë¼ì´íŠ¸ ë³´ë¼
    const textPurple = '#5b2d91';   // í…ìŠ¤íŠ¸ ë³´ë¼

    const R_outer = cx - 2;         // ì „ì²´ ë°˜ì§€ë¦„
    const ringWidth = 26;           // ì™¸ê³½ ë³´ë¼ í…Œë‘ë¦¬ ë‘ê»˜
    const R_wedge = R_outer - ringWidth; // ì›¨ì§€ ì‹œì‘ ë°˜ì§€ë¦„
    const R_dots = R_outer - ringWidth/2; // í° ì  ìœ„ì¹˜
    const dotR = 6;                 // í° ì  ë°˜ì§€ë¦„

    // 1) ì™¸ê³½ ì§„ë³´ë¼ ì›(í…Œë‘ë¦¬)
    ctx.beginPath();
    ctx.arc(cx, cy, R_outer, 0, Math.PI*2);
    ctx.fillStyle = deepPurple;
    ctx.fill();

    // 2) ì™¸ê³½ í° ì  ì¥ì‹
    const dots = 24; // ì  ê°œìˆ˜
    for(let i=0;i<dots;i++){
      const ang = (i / dots) * Math.PI*2;
      const x = cx + Math.cos(ang) * R_dots;
      const y = cy + Math.sin(ang) * R_dots;
      ctx.beginPath();
      ctx.arc(x, y, dotR, 0, Math.PI*2);
      ctx.fillStyle = dotWhite;
      ctx.fill();
    }

    // 3) ì•ˆìª½ ë³´ë¼ ë§(í…Œë‘ë¦¬ ì•ˆìª½ ë°ì€ ë³´ë¼)
    ctx.beginPath();
    ctx.arc(cx, cy, R_wedge + 10, 0, Math.PI*2);
    ctx.fillStyle = ringLight;
    ctx.fill();

    // 4) ì›¨ì§€(ì—°ë³´ë¼ ë‘ í†¤ ë²ˆê°ˆì•„)
    const anglePer = (2 * Math.PI) / numSegments;
    for(let i=0;i<numSegments;i++){
      const a0 = i * anglePer;
      const a1 = (i+1) * anglePer;
      ctx.beginPath();
      ctx.moveTo(cx, cy);
      ctx.arc(cx, cy, R_wedge, a0, a1);
      ctx.closePath();
      ctx.fillStyle = (i % 2 === 0) ? wedgeA : wedgeB;
      ctx.fill();

      // ê¸€ì
      ctx.save();
      ctx.translate(cx, cy);
      const mid = (a0 + a1)/2;
      ctx.rotate(mid);
      ctx.textAlign = 'right';
      ctx.fillStyle = textPurple;
      ctx.font = 'bold 16px Nanum Gothic, sans-serif';
      // ê¸¸ë©´ ì˜ë¼ì„œ í‘œì‹œ
      let t = prizes[i];
      while(ctx.measureText(t).width > (R_wedge-18)*0.9 && t.length>2){ t = t.slice(0,-1); }
      ctx.fillText(t, R_wedge - 12, 6);
      ctx.restore();
    }

    // 5) ì¤‘ì•™ ë§/ì› (ì‚¬ì§„ì²˜ëŸ¼ ì´ì¤‘ ì›)
    // ì—°í•œ ë³´ë¼ ì•ˆìª½ ì›
    ctx.beginPath();
    ctx.arc(cx, cy, 56, 0, Math.PI*2);
    ctx.fillStyle = '#dccbf9';
    ctx.fill();
    // ë” ë°ì€ ë³´ë¼ ì¤‘ì‹¬ ì›
    ctx.beginPath();
    ctx.arc(cx, cy, 40, 0, Math.PI*2);
    ctx.fillStyle = '#f1eaff';
    ctx.fill();

    // ìº”ë²„ìŠ¤ ë Œë”
    wheel.innerHTML = '';
    wheel.appendChild(canvas);
  }

  function degreeToSegment(degree) {
    const adjustedDegree = (degree + 90) % 360;       // ìœ„ìª½ í¬ì¸í„° ê¸°ì¤€
    const segmentAngle = 360 / prizes.length;
    const index = Math.floor(adjustedDegree / segmentAngle);
    return (prizes.length - 1 - index);
  }

  function spinWheel() {
    if(spinsLeft <= 0) { alert("ë” ì´ìƒ ëŒë¦´ ìˆ˜ ìˆëŠ” íšŸìˆ˜ê°€ ì—†ìŠµë‹ˆë‹¤!"); return; }
    spinBtn.disabled = true;

    const extraRotation = 360 * (5 + Math.random() * 3);
    currentRotation += extraRotation;

    wheel.style.transition = 'transform 4s cubic-bezier(0.33, 1, 0.68, 1)';
    wheel.style.transform = `rotate(${currentRotation}deg)`;

    setTimeout(() => {
      spinBtn.disabled = false;
      spinsLeft--;
      spinsLeftSpan.textContent = spinsLeft;

      const normDegree = currentRotation % 360;
      const prizeIndex = degreeToSegment(normDegree);
      const result = prizes[prizeIndex];
      lastResultSpan.textContent = result;

      const now = new Date();
      const timeStr = now.toLocaleTimeString();
      const newRecord = document.createElement('div');
      newRecord.textContent = `${timeStr} - ${result}`;
      historyDiv.appendChild(newRecord);
    }, 4000);
  }

  function determineSpins(amount) {
    if(amount >= 90000) return 3;
    if(amount >= 50000) return 2;
    if(amount >= 30000) return 1;
    return 0;
  }

  applyAmountBtn.addEventListener('click', () => {
    const amount = Number(purchaseAmountInput.value);
    spinsLeft = determineSpins(amount);
    spinsLeftSpan.textContent = spinsLeft;

    if(spinsLeft > 0){
      tierInfoDiv.textContent = `êµ¬ë§¤ê¸ˆì•¡ ${amount.toLocaleString()}ì› - ${spinsLeft}íšŒ ë½‘ê¸° ê¸°íšŒê°€ ì£¼ì–´ì§‘ë‹ˆë‹¤!`;
      spinBtn.disabled = false;
    } else {
      tierInfoDiv.textContent = `ë½‘ê¸° ì°¸ì—¬ ì¡°ê±´(3ë§Œì› ì´ìƒ)ì„ ì¶©ì¡±í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.`;
      spinBtn.disabled = true;
    }
    lastResultSpan.textContent = '-';
    historyDiv.innerHTML = '<strong>íˆìŠ¤í† ë¦¬:</strong><br/>';
  });

  spinBtn.addEventListener('click', spinWheel);
  drawWheel();
</script>

</body>
</html>
